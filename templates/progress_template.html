<div class="card p-4 mt-3 shadow">
    <button id="runBtn" class="btn btn-primary mb-3"><i class="fas fa-play"></i> Mulai Proses</button>

    <div class="progress" style="height: 25px;">
        <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%">0%</div>
    </div>

    <div id="statusMsg" class="mt-3 text-center"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const btn = document.getElementById("runBtn");
    const progressBar = document.getElementById("progressBar");
    const statusMsg = document.getElementById("statusMsg");

    btn.addEventListener("click", function() {
        btn.disabled = true;
        progressBar.classList.remove("bg-success", "bg-danger");
        progressBar.style.width = "0%";
        progressBar.textContent = "0%";
        statusMsg.innerHTML = "üîÑ Proses sedang berjalan...";

        let progress = 0;
        const interval = setInterval(() => {
            progress += 5;
            if (progress <= 90) {
                progressBar.style.width = progress + "%";
                progressBar.textContent = progress + "%";
            }
        }, 400);

        fetch("{{ endpoint }}", { method: "POST" })
        .then(res => res.json())
        .then(data => {
            clearInterval(interval);
            progressBar.style.width = "100%";
            progressBar.textContent = "100%";
            btn.disabled = false;

            if (data.status === "success") {
                progressBar.classList.add("bg-success");
                statusMsg.innerHTML = `<div class="alert alert-success mt-3">${data.message}</div>`;
            } else {
                progressBar.classList.add("bg-danger");
                statusMsg.innerHTML = `<div class="alert alert-danger mt-3">${data.message}</div>`;
            }
        })
        .catch(err => {
            clearInterval(interval);
            btn.disabled = false;
            progressBar.classList.add("bg-danger");
            statusMsg.innerHTML = `<div class="alert alert-danger mt-3">‚ö†Ô∏è Error: ${err}</div>`;
        });
    });
});
</script>
